!function(){"use strict";function softGrid($filter,$base64,$timeout,$compile){return{restrict:"E",replace:!0,scope:{data:"=",cols:"=",width:"=",actions:"=",hide:"=",subgrid:"=",template:"=",sgControls:"=",sgMenu:"=",sgStore:"="},templateUrl:"softgrid.html",link:function(scope,element){function _getFilteredData(){if(enableLog&&console.log("getFilteredData"),scope.filteredData=scope.data,""===scope.sg_filter||null===scope.sg_filter||angular.isUndefined(scope.sg_filter))scope.sg_sort({item:scope.sg_orderBy},scope.sg_orderByColIndex,!0);else{var e=scope.cols.filter(function(e){return e.checked});e.length<=0&&(e=scope.sg_cols),scope.filteredData=scope.filteredData.filter(function(o){var s,a=!1;for(s=0;s<e.length;s++)if(("text"===e[s].type||"html"===e[s].type||"date"===e[s].type||!angular.isDefined(e[s].type))&&e[s].item&&"string"!=typeof e[s].item){var t=e[s].item(o);if(null!==t&&void 0!==t){"string"!=typeof t&&(t=t.toString()),t=removeAccents(t);var n=removeAccents(scope.sg_filter);if(t.indexOf(n)>-1){a=!0;break}}}return a}),scope.sgControls&&angular.isDefined(scope.sgControls.filtered)&&(scope.sgControls.filtered=scope.filteredData),scope.sg_sort({item:scope.sg_orderBy},scope.sg_orderByColIndex,!0)}}function removeAccents(e){if(!e)return e;e=e.toUpperCase();var o={a:/[\xE0-\xE6]/g,e:/[\xE8-\xEB]/g,i:/[\xEC-\xEF]/g,o:/[\xF2-\xF6]/g,u:/[\xF9-\xFC]/g,c:/\xE7/g,n:/\xF1/g},s=[["Á","A"],["À","A"],["Â","A"],["Ã","A"],["É","E"],["È","E"],["Ê","E"],["Í","I"],["Ì","I"],["Î","I"],["Ó","O"],["Ò","O"],["Ô","O"],["Õ","O"],["Ú","U"],["Ù","U"],["Û","U"]];for(var a in o){var t=o[a];e=e.replace(t,a)}var n;for(n=0;n<s.length;n++)e=e.replace(s[n][0],s[n][1]);return e.toUpperCase()}function createTable(){var e="<table border='1' cellpadding='5'>",o=0;e+="<tr bgcolor='orange'>";var s=null;for(o=0;o<scope.cols.length;o++)"subgrid"!=scope.cols[o].type?angular.isFunction(scope.cols[o].item)&&(e+="<td><b>"+scope.cols[o].title+"</b></td>"):s=scope.cols[o].title;null!=s&&(e+="<td align='center'><b>"+s+"</b>"),e+="</tr>";var a;for(o=0;o<scope.data.length;o++){var t=null;for(e+="<tr valign='top'>",a=0;a<scope.cols.length;a++)if("subgrid"!=scope.cols[a].type){var n="";scope.data[o]&&(n=angular.isFunction(scope.cols[a].item)?scope.cols[a].item(scope.data[o]):scope.data[o][scope.cols[a].propriedade]),n||(n=" - "),angular.isString(n)&&(n=removerCaracteresInvalidos(n)),angular.isFunction(scope.cols[a].item)&&(e+="<td>",e+=n,e+="</td>")}else t=scope.cols[a];if(null!=t){var r=t.cols,c=t.item(scope.data[o]);c.length>0&&(e+="<td bgcolor='#F6F6F6'>",e+="<table border='1'>",e+="<tr>",angular.forEach(r,function(o){e+="<td><b>",e+=o.title,e+="</b></td>"}),e+="</tr>",angular.forEach(c,function(o){e+="<tr>",angular.forEach(r,function(s){var a="";o&&(a=angular.isFunction(s.item)?s.item(o):o[s.propriedade]),a||(a=" - "),angular.isString(a)&&(a=removerCaracteresInvalidos(a)),e+="<td>",e+=a,e+="</td>"}),e+="</tr>"}),e+="</table>",e+="</td>")}e+="</tr>"}return e+="</table>"}function _atualizarPaginacao(){if(scope.data){enableLog&&console.log("atualizarPaginacao"),scope.totalPages=scope.filteredData.length/scope.sg_linesPerPage,scope.totalPages=scope.totalPages>parseInt(scope.totalPages)?parseInt(scope.totalPages)+1:scope.totalPages,scope.sg_currentPage=scope.totalPages<scope.sg_currentPage?scope.totalPages:scope.sg_currentPage,scope.soft_pages=[],scope.soft_pages.push({text:"<span class='fa fa-chevron-left'></span>",value:-1,active:!1}),scope.totalPages>1&&scope.soft_pages.push({text:"1..",value:1,active:1===scope.sg_currentPage});for(var e=scope.sg_currentPage,o=2;o<scope.totalPages;o++){var s=o==e;(o<e+3||e<=3&&o<=6)&&(e>=3&&o>e-3||e<=3&&o<=5||e>=3&&o>=e&&o<=e-3||e>=scope.totalPages-3&&o>=scope.totalPages-5||e<=3&&o<=6)&&scope.soft_pages.push({text:o,value:o,active:s})}scope.soft_pages.push({text:".."+scope.totalPages,value:scope.totalPages,active:scope.sg_currentPage===scope.totalPages}),scope.soft_pages.push({text:"<span class='fa fa-chevron-right'></span>",value:0,active:!1})}}function maskEmail(e){return"<a href='mailto:"+e+"'><span class='fa fa-envelope-o'></span> "+e+"</a>"}function maskPhone(e){return e=e.replace(/\D/g,""),e=e.replace(/^(\d{2})(\d)/g,"($1) $2"),e=e.replace(/(\d)(\d{4})$/,"$1-$2")}function removerCaracteresInvalidos(e){return e.replace("\\","").replace('"',"").replace("“","").replace("”","").replace("‘","").replace("’","").replace("º","").replace("–","")}function _configurarRedimensionarColuna(){$(".softgrid th").mousedown(function(e){scope.elementoRedimensionado=$(this),scope.redimensionandoColuna=!0,scope.posicaoElementoX=e.pageX,scope.larguraElementoX=$(this).width()}),$(document).mousemove(function(e){scope.redimensionandoColuna&&$(scope.elementoRedimensionado).width(scope.larguraElementoX+(e.pageX-scope.posicaoElementoX))}),$(document).mouseup(function(){scope.redimensionandoColuna&&(scope.redimensionandoColuna=!1,scope.$apply())})}function _obterColuna(e){return scope.sg_cols[e]}function _obterLinha(e){return scope.showData[e]}function _hookDropDown(){$(".softgrid-container .dropdown").on("click",function(){var e=$(this),o=e.offset().top,s=$(this).height(),a=e.find(".dropdown-menu"),t=$(this).find(".btn").offset().left,n=$(window).scrollTop();a.css("top",o+s-n),a.css("left",t)}),$(window).scroll(function(){var e=$(".softgrid .dropdown.open");if(e.length>0){var o=e.find(".dropdown-menu"),s=$(this).scrollTop();o.css("top",e.offset().top+e.height()-s)}})}function _controlesParaColunas(){var e=[];if(angular.isDefined(scope.cols)&&scope.cols.length>0){if(scope.sgControls&&scope.sgControls.checkBox&&e.push({type:"checkbox",title:"Selecionar",callback:scope.sgControls.checkBox.function,item:scope.sgControls.checkBox.item}),scope.subgrid&&e.push({type:"subgrid",title:"Detalhes",item:scope.subgrid.item,cols:scope.subgrid.cols,menu:scope.subgrid.actions,hide:scope.subgrid.hide,subgrid:scope.subgrid.subgrid}),scope.actions&&scope.actions.length>0){var o={type:"menu",title:"Opções",menu:scope.actions};angular.isDefined(scope.sgControls)&&angular.isDefined(scope.sgControls.showAction)&&(o.showRow=scope.sgControls.showAction),e.push(o)}scope.sgControls&&(scope.sgControls.create&&e.push({type:"action",title:scope.sgControls.create.title?scope.sgControls.create.title:"Criar",callback:scope.sgControls.create.action,icon:scope.sgControls.create.icon?scope.sgControls.create.icon:"fa-plus"}),scope.sgControls.read&&e.push({type:"action",title:scope.sgControls.read.title?scope.sgControls.read.title:"Ver",callback:scope.sgControls.read.action,icon:scope.sgControls.read.icon?scope.sgControls.read.icon:"fa-search"}),scope.sgControls.update&&e.push({type:"action",title:scope.sgControls.update.title?scope.sgControls.update.title:"Criar",callback:scope.sgControls.update.action,icon:scope.sgControls.update.icon?scope.sgControls.update.icon:"fa-pencil"}),scope.sgControls.delete&&e.push({type:"action",title:scope.sgControls.delete.title?scope.sgControls.delete.title:"Criar",callback:scope.sgControls.delete.action,icon:scope.sgControls.delete.icon?scope.sgControls.delete.icon:"fa-trash"})),e=e.concat(scope.cols),scope.sgControls&&scope.sgControls.active&&e.push({type:"switch",title:scope.sgControls.activeTitle?scope.sgControls.activeTitle:"Ativo",item:scope.sgControls.activeCol,callback:scope.sgControls.activeFunction}),scope.sgControls&&scope.sgControls.favorite&&e.push({type:"favorite",title:"Favorito",item:scope.sgControls.favorite.item,callback:scope.sgControls.favorite.function,showRow:scope.sgControls.favorite.show}),scope.sgControls&&scope.sgControls.progress&&e.push({type:"progress",title:"Progresso",class:scope.sgControls.progress.class,item:scope.sgControls.progress.item}),scope.sgControls&&scope.sgControls.approve&&scope.sgControls.approve.showCol&&e.push({type:"approve",title:"Aprovação",showCol:scope.sgControls.approve.showCol,showRow:scope.sgControls.approve.show,callback:scope.sgControls.approve.callback}),flagCol&&(scope.cols=e,scope.sg_cols=scope.cols.filter(function(e){return angular.isUndefined(e.default)||!0===e.default}),flagCol=!1),_getFilteredData()}}function _calcularTamanhoColunaAcoes(){scope.larguraColunaAcoes=0,scope.subgrid&&(scope.larguraColunaAcoes+=60),scope.actions&&scope.actions.length>0&&(scope.larguraColunaAcoes+=60)}function _saveStorage(){if(scope.sgStore&&scope.sgStore.enabled){var e={};e.linesPerPage=scope.sg_linesPerPage,e.currentPage=scope.sg_currentPage,null!==scope.sg_orderBy?(e.orderBy={item:scope.sg_orderBy.toString(),reverse:scope.reverse,index:scope.sg_orderByColIndex},scope.sg_orderByColIndexSaved=e.orderBy.index,scope.sg_orderBySaved={item:scope.sg_orderBy}):(scope.sg_orderBySaved=null,scope.sg_orderByColIndexSaved=null);var o=[],s=0;angular.forEach(scope.sg_cols,function(e){o.push({col:removeAccents(e.title).replace(" ",""),index:s}),s++}),e.cols=o,localStorage.setItem("SG-STORE_"+scope.sgStore.id,angular.toJson(e)),enableLog&&console.log("_saveStorage")}}function _loadStorage(){if(scope.sgStore&&scope.sgStore.enabled){var _properties=angular.fromJson(localStorage.getItem("SG-STORE_"+scope.sgStore.id));if(_properties){if(scope.sg_linesPerPage=scope.sg_linesPerPageInput=_properties.linesPerPage,scope.sg_currentPage=_properties.currentPage,_properties.orderBy&&""!==_properties.orderBy.item){var _item={item:eval("("+_properties.orderBy.item+")")};scope.sg_orderByColIndexSaved=_properties.orderBy.index,scope.sg_orderBySaved=_item,scope.reverse=_properties.orderBy.reverse,scope.sg_sort(_item,_properties.orderBy.index,!0)}if(_properties.cols){_controlesParaColunas();var _colunas=[],_limpar=!1;angular.forEach(_properties.cols,function(e){var o=scope.cols.filter(function(o){return removeAccents(o.title).replace(" ","")===e.col})[0];o?_colunas.push(o):_limpar=!0}),scope.sg_cols=_colunas,_limpar&&scope.limparConfiguracaoColuna(),_getFilteredData()}enableLog&&console.log("_loadStorage"),_atualizarPaginacao()}}}function _alterarColunas(e,o){var s=[],a={};angular.forEach(scope.cols,function(e){removeAccents(e.title).replace(" ","")===o&&(a=e)}),angular.forEach(scope.sg_cols,function(t){removeAccents(t.title).replace(" ","")===e&&s.push(a),removeAccents(t.title).replace(" ","")!==o&&s.push(t)}),scope.sg_cols=s,_saveStorage(),_getFilteredData()}function _renderizarTabela(){enableLog&&console.log("_renderizarTabela"),$(scope.container).html(""),$(scope.configuration).html("");var e=!1,o=[];o.push("<div style='"+(scope.width?"width:"+scope.width+"px":"width: 100%")+"'>"),o.push("<table width='100%' "+(scope.subgrid?"id='softgrid'":"")+" class='softgrid "+scope.template+"'>"),o.push("<thead>");var s=0;angular.forEach(scope.sg_cols,function(e){o.push("<th id='sg_col_"+removeAccents(e.title).replace(" ","")+"' class='softgrid-th-drop'>"),o.push("<span class='fa fa-arrow-left'></span>"),o.push("<span class='title' ng-click='sg_sort(sg_cols["+s+"], "+s+")'>"),o.push(e.title),s===scope.sg_orderByColIndex&&o.push("<span class='fa "+(scope.reverse?"fa-sort-amount-desc":"fa-sort-amount-asc")+"'></span>"),o.push("</span>"),"checkbox"===e.type&&o.push("<input style='margin: 0px 0px 0px 5px;' type='checkbox' "+(scope.sg_checked?"checked":"")+" ng-click='sg_checkAll("+s+")'>"),scope.configuracaoAberta&&o.push("<span class='fa fa-times pull-right' ng-click='removerColuna(sg_cols["+s+"])'></span>"),o.push("</th>"),s++}),o.push("</thead>"),o.push("<tbody>"),scope.showData=$filter("limitTo")(scope.filteredData,scope.sg_linesPerPage,scope.sg_currentPage*scope.sg_linesPerPage-scope.sg_linesPerPage);var a=0;angular.forEach(scope.showData,function(s){var t="";scope.sgControls&&(scope.sgControls.changeRowColor&&"string"==typeof scope.sgControls.rowColor?!0===scope.sgControls.changeRowColor(s)&&(t="style='background-color: "+scope.sgControls.rowColor+"'"):angular.isDefined(scope.sgControls.rowColor)&&(t="style='background-color: "+scope.sgControls.rowColor(s)+"'")),o.push("<tr id='sg_linha_"+a+"' ng-click='sg_selecionarLinha("+a+")' class='soft-row "+(a%2?"soft-row-striped":"")+(scope.linhaSelecionadaIndex,"")+"' "+t+">");var n=0;angular.forEach(scope.sg_cols,function(t){var r="text"!==t.type&&"html"!==t.type&&angular.isDefined(t.type)?"text-align: center;":"";t.width="text"!==t.type&&"html"!==t.type&&angular.isDefined(t.type)&&angular.isUndefined(t.width)?"110px;":t.width;var c=t.style?t.style(s):"";if(o.push("<td style='"+c+r+(t.width?"width: "+t.width:"")+"'>"),angular.isUndefined(t.type)||"text"===t.type||"html"===t.type||"date"===t.type){var l=t.edit?"title='Clique aqui para editar' ng-click='sg_openEdit("+n+", "+a+", $event)'":"";o.push("<div "+l+" style='"+(t.align?"text-align: "+t.align+";":"text-align: left;")+"'>"),t.popOver?o.push("<label style='text-decoration: underline; cursor: pointer' popover data-toggle='popover' data-trigger='hover' data-content='"+t.item(s)+"'>"+$filter("limitTo")(t.item(s),t.maxLength?t.maxLength:999)+"</label>"):(o.push("<label style='width: 100%; "+c+"'>"),angular.isFunction(t.click)&&o.push("<a style='color: #f39c12; cursor: pointer; font-weight: bold' ng-click='sg_cols["+n+"].click(showData["+a+"])'>"),o.push(scope.sg_mask(t.type,t.item(s))),angular.isFunction(t.click)&&o.push("</a>"),o.push("</label>"))}else if("checkbox"===t.type)o.push("<input type='checkbox' ng-click='sg_cols["+n+"].callback(showData["+a+"])' "+(s[scope.sg_cols[n].item]?"checked":"")+">");else if("subgrid"===t.type)o.push("<button type='button' class='btn btn-default btn-sm btn-subgrid' ng-click='abrirSubGrid("+n+","+a+")'>"),o.push("<span class='fa "+(scope.showSubGrid?"fa-compress":"fa-expand")+"'></span></button>"),e=!0;else if("menu"===t.type){if(angular.isDefined(t.showRow)&&!t.showRow(s))return void n++;o.push("<div class='dropdown'>"),o.push("<button type='button' class='btn btn-default btn-sm dropdown-toggle' data-toggle='dropdown' aria-haspopup='true' aria-expanded='false'>"),o.push("<span class='fa fa-bars'></span></button>"),o.push("<ul class='dropdown-menu dropdown-menu-left'>");i=0;angular.forEach(t.menu,function(e){!angular.isDefined(e.show)||e.show(s)?(o.push("<li>"),o.push("<a ng-click='sg_cols["+n+"].menu["+i+"].function(showData["+a+"])'><span class='"+e.icon+"'></span>  "+e.title+"</a>"),o.push("</li>"),i++):i++}),o.push("</ul></div>")}else if("action"===t.type)o.push("<button class='btn btn-default btn-sm' ng-click='sg_cols["+n+"].callback(showData["+a+"])' title='"+t.title+"'>"),o.push("<span class='fa "+t.icon+"'></span></button>");else if("switch"===t.type)o.push("<label class='switch'>"),o.push("<input type='checkbox' ng-click='sg_cols["+n+"].callback(showData["+a+"])' "+(scope.sg_cols[n].item(s)?"checked":"")+">"),o.push("<div class='slider round'></div>"),o.push("</label>");else if("favorite"===t.type){if(angular.isDefined(t.show)&&!t.show(s))return void n++;o.push("<span class='fa fa-star "+(t.item(s)?"active":"")+"' ng-click='sg_favoritar("+n+", "+a+")'></span>")}else if("progress"===t.type)o.push("<div class='progress'>"),o.push("<div class='progress-bar "+(t.class?t.class(s):"")+"' role='progressbar' style='width: "+t.item(s)+"%;'>"),o.push(t.item(s)+"%</div></div>");else if("approve"===t.type){if(!t.showCol(s)||!t.showRow(s))return void n++;o.push("<button title='Aprovar' class='btn btn-default btn-sm' ng-click='sg_cols["+n+"].callback(showData["+a+"], true)'><span class='fa fa-thumbs-up'></span></button>"),o.push("<button title='Reprovar' class='btn btn-default btn-sm' ng-click='sg_cols["+n+"].callback(showData["+a+"], false)'><span class='fa fa-thumbs-down'></span></button>")}else if("select"===t.type){o.push("<div class='dropdown softgrid-dropdown-container'>"),o.push("<button type='button' class='btn btn-default btn-sm dropdown-toggle softgrid-dropdown' data-toggle='dropdown' aria-haspopup='true' aria-expanded='false'>"),o.push("<span class='fa fa-caret-down'></span>"+scope.showData[a][scope.sg_cols[n].item][scope.sg_cols[n].field.text]+"</button>"),o.push("<ul class='dropdown-menu dropdown-menu-left'>");var i=0;angular.forEach(t.data,function(e){o.push("<li>"),o.push("<a ng-click='sg_select("+n+", "+a+", "+i+")'> "+e[t.field.text]+"</a>"),o.push("</li>"),i++}),o.push("</ul></div>")}o.push("</div></td>"),n++}),o.push("</tr>"),e&&(o.push("<tr style='display: none' class='"+(a%2?"soft-row-striped":"")+"'>"),o.push("<td id='sg_subgrid_"+a+"' colspan='"+scope.sg_cols.length+"'>"),o.push("</td>"),o.push("</tr>")),a++}),angular.isDefined(scope.showData)&&scope.showData.length<=0&&o.push("<tr><td style='text-align: center;' colspan='"+scope.sg_cols.length+"'>Não há dados a serem exibidos.</td></tr>"),o.push("</tbody>"),o.push("</table>"),o.push("</div>"),angular.element(scope.container).append($compile(o.join(""))(scope));var t="<h5><label class='label label-primary'>Customizar Colunas</label></h5>",n=!0;angular.forEach(scope.cols,function(e){var o=scope.sg_cols.filter(function(o){return o.title===e.title});(!1===e.default&&o.length<=0||(angular.isUndefined(e.default)||!0===e.default)&&o.length<=0)&&(t+="<div id='sg_col_"+removeAccents(e.title).replace(" ","")+"' class='softgrid-configuration-col'>"+e.title+"</div>",n=!1)}),n&&(t+="<small>Todas as colunas estão sendo exibidas.</small>"),t+="<a href='javascript:void(0)' ng-click='limparConfiguracaoColuna()'>Limpar alterações</a>",angular.element(scope.configuration).append($compile(t)(scope)),scope.configuracaoAberta&&(_configurarDrop(),_configurarDrag()),_hookDropDown()}function _configurarDrag(){angular.forEach($(scope.configuration).find(".softgrid-configuration-col"),function(e,o){var s=angular.element(e);"true"!==s.attr("draggable")&&(s.attr("draggable","true"),s.on("dragstart",_aoArrastarTarefa),s.on("dragend",_aoPararArrastarTarefa))})}function _aoArrastarTarefa(e){e.dataTransfer?e.dataTransfer.setData("Text",e.target.id):e.originalEvent.dataTransfer.setData("Text",e.target.id)}function _aoPararArrastarTarefa(e){}function _configurarDrop(){angular.forEach($(scope.container).find(".softgrid-th-drop"),function(e,o){var s=angular.element(e);s.hasClass("softgrid-th-drop")&&"true"!==s.attr("draggable")&&(s.attr("draggable","true"),s.on("dragstart",_aoArrastarTarefa),s.on("dragover",function(e){e.preventDefault()}),s.on("dragenter",function(e){$(e.target).addClass("active")}),s.on("dragleave",function(e){$(e.target).removeClass("active")}),s.on("drop",_aoDroparTarefa))})}function _aoDroparTarefa(e){e.preventDefault();var o="";o=e.dataTransfer?e.dataTransfer.getData("Text").replace("sg_col_",""):e.originalEvent.dataTransfer.getData("Text").replace("sg_col_","");_alterarColunas(e.target.id.replace("sg_col_",""),o)}var enableLog=!1;scope.loading=!1,scope.container=$(element[0]).find(".softgrid-container")[0],scope.configuration=$(element[0]).find(".softgrid-configuration")[0],scope.sg_currentPage=1,scope.sg_linesPerPageInput=10,scope.sg_linesPerPage=10,scope.sg_orderBy="",scope.sg_filterSearch="",scope.larguraColunaControles=0,scope.sg_selected=!1,scope.sg_checked=!1,scope.filteredData=[],scope.sg_filter="",scope.sg_cols=[];var firstLoad=!0;scope.sg_changePage=function(e){enableLog&&console.log("sg_changePage"),-1===e&&scope.sg_currentPage>1?scope.sg_currentPage=scope.sg_currentPage-1:-1===e&&1===scope.sg_currentPage?scope.sg_currentPage=scope.totalPages:0===e&&scope.sg_currentPage===scope.totalPages?scope.sg_currentPage=1:0===e&&scope.sg_currentPage<scope.totalPages?scope.sg_currentPage=scope.sg_currentPage+1:scope.sg_currentPage=e,_atualizarPaginacao(),_getFilteredData()},scope.sg_changeLinesPerPage=function(e){(-1===e&&scope.sg_linesPerPageInput>10||1===e)&&(scope.sg_linesPerPageInput=scope.sg_linesPerPageInput+10*e),enableLog&&console.log("sg_changeLinesPerPage")},scope.sg_sort=function(e,o,s){if(enableLog&&console.log("sg_sort"),!angular.isUndefined(scope.filteredData)){if(scope.filteredData.length>0){if(null!==scope.sg_orderBy&&scope.sg_orderByColIndex===o&&scope.reverse&&!s)return scope.sg_orderBy=null,scope.reverse=!1,scope.sg_orderByColIndex=-1,firstLoad||_saveStorage(),void _renderizarTabela();s||(null!==scope.sg_orderBy&&scope.sg_orderByColIndex!==o&&(scope.reverse=!1),null!==scope.sg_orderBy&&scope.sg_orderByColIndex===o&&(scope.reverse=!0)),scope.sg_orderByColIndex=o,scope.filteredData=$filter("orderBy")(scope.filteredData,e.item,scope.reverse),scope.sg_orderBy=e.item,firstLoad||_saveStorage()}_atualizarPaginacao(),_renderizarTabela()}},scope.sg_mask=function(e,o){return"phone"===e?maskPhone(o):"mail"===e?maskEmail(o):"date"===e?$filter("date")(o,"dd/MM/yyyy"):o},scope.sg_selectAll=function(){scope.filteredData&&scope.filteredData.length>0&&(scope.sg_selected=!scope.sg_selected,angular.forEach(scope.filteredData,function(e){scope.sgControls.select.item&&(e[scope.sgControls.select.item]=scope.sg_selected)}),scope.sgControls.select.callback(scope.filteredData))},scope.sg_checkAll=function(e){scope.filteredData&&scope.filteredData.length>0&&(scope.sg_checked=!scope.sg_checked,angular.forEach(scope.filteredData,function(o){scope.sg_cols[e].item&&(o[scope.sg_cols[e].item]=scope.sg_checked)}),scope.sg_cols[e].callback(scope.filteredData),_renderizarTabela())},scope.sg_checkCol=function(e,o){e.checked=!e.checked,o.stopPropagation(),_getFilteredData()},scope.sg_hook=function(){_atualizarPaginacao(),_hookDropDown()},scope.exportExcel=function(){for(var e=createTable(),o=new Array(e.length),s=0;s<e.length;s++)o[s]=e.charCodeAt(s);var a=new Uint8Array(o),t=new Blob([a],{type:"data:application/vnd.ms-excel"}),n=document.createElement("a");n.setAttribute("href",URL.createObjectURL(t)),n.setAttribute("download",(new Date).toLocaleString()+".xls"),document.body.appendChild(n),n.click(),document.body.removeChild(n)},scope.exportarPDF=function(){scope.loading=!0;var e=$(element[0]).find(".softgrid-container")[0],o=$(e).width(),s=scope.sg_cols,a=scope.sg_linesPerPage,t=[595.28,841.89];scope.sg_cols=s.filter(function(e){return angular.isFunction(e.item)&&"subgrid"!=e.type}),scope.sg_linesPerPage=scope.data.length,_renderizarTabela(),$timeout(function(){$(e).width(t[1]).css("max-width","none"),$(e).css("max-height","none"),$(e).height(e.clientHeight),$(e).css("position","fixed"),$(e).css("top","0"),$(e).css("left","0"),$timeout(function(){var n=$(element[0]).find(".softgrid-container")[0];domtoimage.toPng(n,{quality:.75,bgcolor:"#FFFFFF",height:e.clientHeight,width:t[1]}).then(function(t){var n=new Image;n.onload=function(){for(var t=new jsPDF({unit:"px",format:"a4",orientation:"landscape"}),r=0;r<=e.clientHeight/980;r++){var c=n,l=1120*r;window.onePageCanvas=document.createElement("canvas"),onePageCanvas.setAttribute("width",778),onePageCanvas.setAttribute("height",1120);onePageCanvas.getContext("2d").drawImage(c,0,l,778,1120,0,0,778,1120);var i=onePageCanvas.toDataURL("image/png",1),p=onePageCanvas.width,g=onePageCanvas.clientHeight;r>0&&t.addPage(),t.setPage(r+1),t.addImage(i,"PNG",10,10,.72*p,.71*g)}t.save((new Date).toLocaleString()+".pdf"),$(e).width(o),$(e).height("auto"),$(e).css("position","relative"),scope.sg_cols=s,scope.sg_linesPerPage=a,_renderizarTabela(),scope.loading=!1,scope.$apply()},n.src=t})},1e3)},1e3)},scope.redimensionandoColuna=!1,scope.elementoRedimensionado=void 0,scope.posicaoElementoX=0,scope.larguraElementoX=0,scope.sg_edit=function(e){if(null!==scope.sg_editandoColunaValor&&""!==scope.sg_editandoColunaValor){var o=_obterColuna(scope.sg_editandoColunaIndex);scope.showData[scope.sg_editandoLinhaIndex][o.edit.item]=scope.sg_editandoColunaValor,o.edit.function(_obterLinha(scope.sg_editandoLinhaIndex))}scope.sg_editandoColuna=!1,scope.sg_editandoColunaValor=null,scope.sg_editandoLinhaIndex=0,scope.sg_editandoColunaIndex=0,_renderizarTabela()},scope.sg_editandoColuna=!1,scope.sg_editandoColunaValor=null,scope.sg_editandoLinhaIndex=0,scope.sg_editandoColunaIndex=0,scope.sg_openEdit=function(e,o,s){if(!scope.sg_editandoColuna){scope.sg_editandoColuna=!0,scope.sg_editandoColunaIndex=e,scope.sg_editandoLinhaIndex=o,scope.sg_editandoValor=scope.sg_cols[e].item(scope.showData[o]);var a=s.currentTarget,t="<input id='sg_edit_input' class='edit-input' ng-model='sg_editandoColunaValor' ng-blur='sg_edit(this)' tooltip data-toggle='tooltip' data-placement='top' title='Digite o novo valor. Valor atual: "+scope.sg_editandoValor+"'style='color: black !important; width: "+scope.sg_cols[e].edit.width+";'>";angular.element(a).append($compile(t)(scope)),$(a).find("label").css("display","none");var n=$("#sg_edit_input");$timeout(function(){""!==n.value?n.select():n.focus()},200)}},$timeout(_configurarRedimensionarColuna,500),scope.$watch("showData",function(e,o){$timeout(_renderizarTabela,200)},!0),scope.$watch("data",function(){enableLog&&console.log("dataWatcher"),_getFilteredData(),scope.sg_orderBySaved&&(scope.sg_orderByColIndex=-1,angular.isDefined(scope.sg_orderBySaved)&&scope.sg_sort(scope.sg_orderBySaved,scope.sg_orderByColIndexSaved,!0)),scope.data&&scope.data.length>0&&(firstLoad?(scope.sgStore&&_loadStorage(),firstLoad=!1):scope.sg_currentPage=1),_atualizarPaginacao()}),scope.$watch("sg_linesPerPageInput",function(){enableLog&&console.log("linesPerPageInputWatcher"),scope.sg_linesPerPageInput>0&&(scope.sg_linesPerPage=parseInt(scope.sg_linesPerPageInput),firstLoad||_saveStorage(),_getFilteredData())}),scope.$watch("sgControls",function(){enableLog&&console.log("sgControlsWatcher"),angular.isDefined(scope.sgControls)&&scope.sgControls&&(scope.sgControls.checkAll=scope.sg_checkAll,scope.sgControls.create&&(scope.larguraColunaControles+=60),scope.sgControls.read&&(scope.larguraColunaControles+=60),scope.sgControls.update&&(scope.larguraColunaControles+=60),scope.sgControls.delete&&(scope.larguraColunaControles+=60))}),scope.$watch("hide",function(){enableLog&&console.log("hideWatcher"),scope.hide&&(!0!==scope.hide.pagination&&!0!==scope.hide.all||(scope.sg_linesPerPage=999))}),scope.$watch("subgrid",_calcularTamanhoColunaAcoes),scope.$watch("actions",_calcularTamanhoColunaAcoes),scope.$watch("sg_currentPage",function(){enableLog&&console.log("currentPageWatcher"),firstLoad||_saveStorage()}),scope.$watch("sg_filter",function(){enableLog&&console.log("filterWatcher"),scope.sg_changePage(1)}),scope.$watch("filteredData",function(){scope.linhaSelecionadaIndex=null});var flagCol=!0;scope.$watch("cols",function(){enableLog&&console.log("colsWatcher"),_controlesParaColunas()}),scope.abrirConfiguracao=function(){scope.configuracaoAberta=!scope.configuracaoAberta,scope.configuracaoAberta?($(scope.configuration).css("width","200px"),$(scope.configuration).css("border","1px solid #ccc"),$(scope.container).css("min-height","300px"),_getFilteredData()):($(scope.configuration).css("width","0"),$(scope.configuration).css("border","0"),$timeout(function(){$(scope.container).css("min-height","0")},500),_getFilteredData(),_configurarRedimensionarColuna())},scope.removerColuna=function(e){scope.sg_cols=scope.sg_cols.filter(function(o){return o.title!==e.title}),_saveStorage(),_getFilteredData()},scope.sg_selecionarLinha=function(e){angular.isDefined(scope.linhaSelecionadaIndex)&&$("#sg_linha_"+scope.linhaSelecionadaIndex).removeClass("active"),scope.linhaSelecionadaIndex=e,$("#sg_linha_"+e).addClass("active")},scope.sg_select=function(e,o,s){scope.sg_cols[e].callback(scope.showData[o],scope.sg_cols[e].data[s]),scope.showData[o][scope.sg_cols[e].item][scope.sg_cols[e].field.text]=scope.sg_cols[e].data[s][scope.sg_cols[e].field.text],scope.showData[o][scope.sg_cols[e].item][scope.sg_cols[e].field.value]=scope.sg_cols[e].data[s][scope.sg_cols[e].field.value]},scope.sg_favoritar=function(e,o){scope.sg_cols[e].callback(scope.showData[o]),$timeout(_renderizarTabela,1e3)},scope.limparConfiguracaoColuna=function(){scope.sg_cols=scope.cols.filter(function(e){return angular.isUndefined(e.default)||!0===e.default}),_saveStorage(),_renderizarTabela()},scope.abrirSubGrid=function(e,o){if($("#sg_subgrid_"+o).hasClass("active"))$("#sg_subgrid_"+o).html(""),$("#sg_subgrid_"+o).removeClass("active"),$($("#sg_subgrid_"+o).parent()).css("display","none");else{var s=[];s.push("<div class='soft-subgrid-container'>"),s.push("<softgrid cols='sg_cols["+e+"].cols' actions='sg_cols["+e+"].menu' data='sg_cols["+e+"].item(showData["+o+"])' hide='sg_cols["+e+"].hide' sg-controls='sg_cols["+e+"].controls' subgrid='sg_cols["+e+"].subgrid' template=\"'soft-subgrid'\"></softgrid>"),s.push("</div>"),angular.element($("#sg_subgrid_"+o)).append($compile(s.join(""))(scope)),$("#sg_subgrid_"+o).addClass("active"),$($("#sg_subgrid_"+o).parent()).css("display","table-row")}}}}}angular.module("softgrid.directive",["base64"]).directive("softgrid",softGrid),softGrid.$injector=["$filter","$base64","$timeout","$compíle"],angular.module("softgrid.directive").directive("popover",function(){return function(e,o){$(o).popover()}}),angular.module("softgrid.directive").directive("tooltip",function(){return function(e,o){$(o).tooltip()}})}(),angular.module("softgrid.directive").run(["$templateCache",function(e){e.put("softgrid.html",'\r\n<div class="softgrid-display" ng-class="{\'softgrid-display-fullscreen\': softgrid.fullscreen}" ng-style="sgControls.fullscreen && softgrid.fullscreen ? { \'z-index\': sgControls.fullscreen.zindex, \'top\': sgControls.fullscreen.top + \'px\'} : \'\'">\r\n\r\n    <div class="grid-controles" ng-style="sgControls.fullscreen && softgrid.fullscreen ? { \'z-index\': (sgControls.fullscreen.zindex + 1), \'top\': (sgControls.fullscreen.top) + \'px\'} : \'\'">\r\n\r\n        <div class="row" ng-hide="hide.all">\r\n\r\n            <div class="col-md-2">\r\n\r\n                <div ng-hide="hide.filter || hide.all">\r\n\r\n                    <label>Filtrar</label>\r\n\r\n                    <div class="input-group">\r\n\r\n                        <div class="input-group-btn">\r\n\r\n                            <button type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false"><span class="fa fa-search"></span></button>\r\n\r\n                            <ul class="dropdown-menu dropdown-menu-left">\r\n\r\n                                <li ng-repeat="col in cols track by $index">\r\n\r\n                                    <a ng-click="sg_checkCol(col, $event)"> <input type="checkbox" ng-checked="col.checked" ng-click="sg_checkCol(col, $event)" /> {{col.title}} </a>\r\n\r\n                                </li>\r\n\r\n                            </ul>\r\n\r\n                        </div>\r\n\r\n                        <input type="text" class="form-control" ng-model="sg_filter" placeholder="Palavra-chave" aria-describedby="filtro-addon">\r\n\r\n                    </div>\r\n\r\n                </div>\r\n\r\n            </div>\r\n\r\n            <div class="col-md-6">\r\n\r\n                <div class="row">\r\n\r\n                    <div class="col-md-4">\r\n\r\n                        <div class="form-group" ng-hide="hide.linesPage || hide.all || hide.pagination" style="margin-bottom: 0;">\r\n\r\n                            <label>Linhas por página</label>\r\n\r\n                            <div class="input-group" style="width: 120px;">\r\n\r\n                        <span class="input-group-btn">\r\n                            <button class="btn btn-default" type="button" ng-click="sg_changeLinesPerPage(-1)">-</button>\r\n                        </span>\r\n\r\n                                <input class="form-control" ng-model="sg_linesPerPageInput">\r\n\r\n                                <span class="input-group-btn">\r\n\t\t\t\t\t\t\t<button class="btn btn-default" type="button" ng-click="sg_changeLinesPerPage(1)">+</button>\r\n\t\t\t\t\t\t</span>\r\n\r\n                            </div>\r\n\r\n                        </div>\r\n\r\n                    </div>\r\n\r\n                    <div class="col-md-4">\r\n\r\n                        <div ng-hide="hide.options || hide.all">\r\n\r\n                            <label>Opções</label>\r\n\r\n                            <div class="input-group">\r\n\r\n                                <input type="text" class="form-control" aria-label="..." value="{{filteredData.length}} encontrado(s)" disabled="true">\r\n\r\n                                <div class="input-group-btn">\r\n\r\n                                    <button type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false"><span class="fa fa-bars"></span></button>\r\n\r\n                                    <ul class="dropdown-menu dropdown-menu-right">\r\n\r\n                                        <li ng-repeat="item in sgMenu">\r\n                                            <a ng-click="item.function()"><span class="{{item.icon}}"></span> {{item.title}}</a>\r\n                                        </li>\r\n\r\n                                        <li role="separator" class="divider" ng-show="sgMenu"></li>\r\n\r\n                                        <li ng-if="sgControls.select"><a ng-click="sg_selectAll()"><span class="fa fa-check"></span> Selecionar Todos</a></li>\r\n\r\n                                        <li><a ng-click="exportExcel()"><span class="fa fa-file-excel-o"></span> Exportar Excel</a></li>\r\n\r\n                                        <li><a ng-click="exportarPDF()"><span class="fa fa-file-pdf-o"></span> Exportar PDF</a></li>\r\n\r\n                                    </ul>\r\n\r\n                                </div>\r\n\r\n                            </div>\r\n\r\n                        </div>\r\n\r\n                    </div>\r\n\r\n                    <div class="col-md-4">\r\n\r\n                        <div ng-hide="hide.fullscreen || hide.all">\r\n\r\n                            <label>&nbsp;</label><br>\r\n                            <button class="btn btn-default" ng-click="softgrid.fullscreen = softgrid.fullscreen ? false : true"><span class="fa fa-expand" ng-class="{\'fa-compress\': softgrid.fullscreen}"></span>\r\n\r\n                                {{ softgrid.fullscreen ? (sgControls.fullscreen.on ? sgControls.fullscreen.on : \'Tela normal\') : (sgControls.fullscreen.off ? sgControls.fullscreen.off : \'Tela cheia\') }}\r\n\r\n                            </button>\r\n\r\n                        </div>\r\n\r\n                    </div>\r\n\r\n                </div>\r\n\r\n            </div>\r\n\r\n            <div class="col-md-4">\r\n\r\n                <nav aria-label="Page navigation" class="pull-right" ng-hide="hide.pagination || hide.all">\r\n\r\n                    <label>Paginação</label>\r\n\r\n                        <ul class="pagination">\r\n\r\n                            <li ng-repeat="soft_page in soft_pages" ng-class="{\'active\': soft_page.active}">\r\n                                <a ng-click="sg_changePage(soft_page.value)" ng-bind-html="soft_page.text"></a>\r\n                            </li>\r\n\r\n                            <li ng-if="sgStore" title="Editar Colunas" ng-click="abrirConfiguracao()"><span class="fa fa-pencil"></span></li>\r\n                            \r\n                            \x3c!-- <div class="input-group-btn">\r\n                                <button type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false"><span class="fa fa-bars"></span></button>\r\n                                <ul class="dropdown-menu dropdown-menu-right">\r\n                                    <li ng-repeat="item in sgMenu">\r\n                                        <a ng-click="item.function()"><span class="{{item.icon}}"></span> {{item.title}}</a>\r\n                                    </li>\r\n                                    <li role="separator" class="divider" ng-show="sgMenu"></li>\r\n                                    <li ng-if="sgControls.select"><a ng-click="sg_selectAll()"><span class="fa fa-check"></span> Selecionar Todos</a></li>\r\n                                    <li><a ng-click="softGridToExcel()"><span class="fa fa-file-excel-o"></span> Gerar Excel</a></li>\r\n                                </ul>\r\n                            </div> --\x3e\r\n                        </ul>\r\n\r\n                </nav>\r\n\r\n            </div>\r\n\r\n        </div>\r\n\r\n    </div>\r\n\r\n    <div class="row">\r\n\r\n        <div class="col-md-12">\r\n\r\n            <div class="softgrid-configuration scrolls">\r\n\r\n\r\n            </div>\r\n\r\n            <div class="softgrid-container">\r\n\r\n\r\n            </div>\r\n\r\n        </div>\r\n\r\n    </div>\r\n\r\n    <div class="row" ng-hide="hide.pagination || hide.all">\r\n\r\n        <div class="col-md-12">\r\n\r\n            <nav aria-label="...">\r\n                <ul class="pager" style="margin-top: 5px;">\r\n                    <li class="previous"><button class="btn btn-default pull-left" ng-click="sg_changePage(-1)"><span aria-hidden="true">&larr;</span> Página anterior</button></li>\r\n                    <li class="next"><button class="btn btn-default pull-right" ng-click="sg_changePage(0)">Próxima página <span aria-hidden="true">&rarr;</span></button></li>\r\n                </ul>\r\n            </nav>\r\n\r\n        </div>\r\n\r\n    </div>\r\n\r\n    <div class="modal-loading" ng-if="loading">\r\n\r\n        <div class="lds-dual-ring"></div>\r\n\r\n    </div>\r\n\r\n</div>\r\n\r\n')}]);